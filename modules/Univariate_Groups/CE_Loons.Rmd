---
layout: page
title: Exercise - Loons
author: Derek H. Ogle
css: "/css/modules.css"
output:
  html_document:
    self_contained: false
    lib_dir: zlibs
---

```{r echo=FALSE, eval=FALSE}
# Renders an appropriate HTML file for the webpage (CTRL-S and CTRL-ALT-C)
source(file.path(here::here(),"rhelpers/rhelpers.R"))
fnm <- "CE_Loons"
dnm <- "modules/Univariate_Groups"
modHTML(file.path(here::here(),dnm,fnm))
FSA::purl2(file.path(here::here(),dnm,paste0(fnm,".Rmd")),
           moreItems=c("source","setwd","fnm","dnm","opts_chunk","CTRL-S"))
```
```{r echo=FALSE}
knitr::opts_chunk$set(echo=FALSE,fig.width=5,fig.height=5,out.width="60%")
library(tidyverse)
#!# Set to your own working directory and have just your filename below.
loon <- read.csv("https://raw.githubusercontent.com/droglenc/NCData/master/Loon1.csv")
```

----

## Background
This is the same data set [introduced here](../Intro2/CE_Loons.html) (which included code for accessing the data). If you did those exercises, then you can use the same data and package (e.g., `tidyverse`) loading portion of your script. If you did not do those exercises then please see that page for the instructions on loading the data.

&nbsp;


## Region 1
Construct `ggplot2` code to match the graph below (as closely as you can).

```{r Loons_Reg1}
reg1 <- ggplot(data=loon,mapping=aes(x=region)) +
  geom_bar(color="gray30",fill="wheat") +
  scale_x_discrete(name="Region of Capture") +
  scale_y_continuous(name="Frequency of Loons",expand=expansion(mult=c(0,0.05))) +
  theme_bw() +  
  theme(panel.grid.major.x=element_blank(),panel.grid.minor.x=element_blank())
reg1
```

&nbsp;

## Region and Sex 1
Construct `ggplot2` code to match the graph below (as closely as you can ... *you don't have to match my colors, but do use other than the default colors*).

```{r Loons_RegSex1, fig.width=6.5, out.width="75%"}
regsex1 <- ggplot(data=loon,mapping=aes(x=region,fill=sex)) +
  geom_bar(color="gray30",alpha=0.7) +
  scale_x_discrete(name="Region of Capture") +
  scale_y_continuous(name="Frequency of Loons",expand=expansion(mult=c(0,0.05))) +
  scale_fill_manual(name="Sex",values=c("#E69F00","#0072B2","#CC79A7")) +
  theme_bw() +  
  theme(panel.grid.major.x=element_blank(),panel.grid.minor.x=element_blank())
regsex1
```

&nbsp;

## Region and Sex 2
Construct `ggplot2` code to match the graph below (as closely as you can).

```{r Loons_RegSex2, fig.width=6.5, out.width="75%"}
regsex2 <- ggplot(data=loon,mapping=aes(x=region,fill=sex)) +
  geom_bar(position="dodge",color="gray30",alpha=0.7) +
  scale_x_discrete(name="Region of Capture") +
  scale_y_continuous(name="Frequency of Loons",expand=expansion(mult=c(0,0.05))) +
  scale_fill_manual(name="Sex",values=c("#E69F00","#0072B2","#CC79A7")) +
  coord_flip() +
  theme_bw() +
  theme(panel.grid.major.x=element_blank(),panel.grid.minor.x=element_blank())
regsex2
```

&nbsp;

## Region 2
Recreate the plot in the "Region 1" section but using summarized data (*i.e., summarize the data first and then use that to construct the plot*).

```{r Loons_Reg2, fig.show='hide'}
sum1 <- loon %>%
  group_by(region) %>%
  summarize(freq=n()) %>%
  ungroup()

reg1a <- ggplot(data=sum1,mapping=aes(x=region,y=freq)) +
  geom_bar(stat="identity",color="gray30",fill="wheat") +
  scale_x_discrete(name="Region of Capture") +
  scale_y_continuous(name="Frequency of Loons",expand=expansion(mult=c(0,0.05))) +
  theme_bw() +  
  theme(panel.grid.major.x=element_blank(),panel.grid.minor.x=element_blank())
reg1a
```

&nbsp;

## Region and Sex 3
Recreate the plot in "Region and Sex 2" using summarized data. [*Hint: you will be asked to use percentages in the next section, so you should prepare your summaries here for that*.]

```{r Loons_RegSex3, fig.show='hide'}
sum2 <- loon %>%
  group_by(region,sex) %>%
  summarize(freq=n()) %>%
  mutate(perc=freq/sum(freq)*100) %>%
  ungroup()
  
regsex3 <- ggplot(data=sum2,mapping=aes(x=region,y=freq,fill=sex)) +
  geom_bar(stat="identity",color="gray30",alpha=0.7) +
  scale_x_discrete(name="Region of Capture") +
  scale_y_continuous(name="Frequency of Loons",expand=expansion(mult=c(0,0.05))) +
  scale_fill_manual(name="Sex",values=c("#E69F00","#0072B2","#CC79A7")) +
  coord_flip() +
  theme_bw() +  
  theme(panel.grid.major.x=element_blank(),panel.grid.minor.x=element_blank())
regsex3
```

&nbsp;

## Region and Sex 4
Construct `ggplot2` code to match the graph below (as closely as you can).

```{r Loons_RegSex4, fig.width=6.5, out.width="75%"}
regsex4 <- ggplot(data=sum2,mapping=aes(x=region,y=perc,fill=sex)) +
  geom_bar(stat="identity",color="gray30",alpha=0.7) +
  scale_x_discrete(name="Region of Capture") +
  scale_y_continuous(name="Percentage of Loons",expand=expansion(mult=c(0,0.05))) +
  scale_fill_manual(name="Sex",values=c("#E69F00","#0072B2","#CC79A7")) +
  coord_flip() +
  theme_bw() +  
  theme(panel.grid.major.x=element_blank(),panel.grid.minor.x=element_blank())
regsex4
```

&nbsp;

## Region and Sex 5
Construct `ggplot2` code to match the graph below (as closely as you can).

```{r Loons_RegSex5}
regsex5 <- ggplot(data=sum2,mapping=aes(x=sex,y=region,fill=perc)) +
  geom_tile() +
  scale_fill_gradient2(low="orange1",high="orange4") +
  geom_text(aes(label=paste0(round(perc,0),"%"))) +
  scale_y_discrete(name=NULL,expand=expansion(mult=0)) +
  scale_x_discrete(name=NULL,expand=expansion(mult=0)) +
  theme_minimal() +
  theme(legend.position="none",
        aspect.ratio=1,
        panel.grid=element_blank()) +
  labs(title="Sex Distribution of Loons",
       subtitle="by region of North America")
regsex5
```
