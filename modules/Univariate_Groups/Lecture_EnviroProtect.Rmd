---
title: "Graphing Univariate Groups"
author: "`r paste('Derek Ogle,',format(Sys.time(),'%B %Y'),sep=' ')`"
output:
  xaringan::moon_reader:
    lib_dir: zlibs
    css: ["zlibs/xaringan-themer.css", "hygge", "ninjutsu"]
    nature:
      ratio: 16:10
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r purler, eval=FALSE, echo=FALSE}
## Use Knit button to make actual slides.
## Makes (Ctrl-S & Ctrl-Alt-C) a script ... will need to edit.
fnm <- "Lecture_EnviroProtect"
FSA::purl2(file.path(here::here(),"modules/Univariate_Groups",paste0(fnm,".Rmd")),
           moreItems=c("source","setwd","fnm","opts_chunk","flipbookr","patchwork",
                       "include_graphics","options","splitPerc","leftAssign","cache"))
```

```{r setup, include = FALSE}
source("../zzzflipbook_settings.R")
#!# Loading the tidyverse package (must do every time)
library(tidyverse)
library(patchwork)
```

# Background

- The General Sociological Survey (GSS) gathers data on American society to monitor and explain trends in attitudes, behaviors, and attributes.
  - Initiated in 1972.
  - Can be accessed from [NORC at the University of Chicago](https://gss.norc.org/)

.center[
```{r, echo=FALSE, out.width="400px"}
knitr::include_graphics("https://derekogle.com/NCGraphing/modules/zimgs/survey.jpg")
```
]

---

# Background

- Downloaded data on the following four characteristics or questions:
  - Respondent's sex, race, and highest educational degree.
  - "Generally speaking, how concerned are you about environmental issues?"
  - "How willing would you be to accept cuts in your standard of living in order to protect the environment?"
- [Data available here](https://raw.githubusercontent.com/droglenc/NCData/master/GSS_Enviro_2010.csv)

.center[
```{r, echo=FALSE, out.width="400px"}
knitr::include_graphics("https://derekogle.com/NCGraphing/modules/zimgs/Driving.jpg")
```
]

---

# Background

- Loaded data into `gss` data.frame.
  - Converted codes to words (use of `mapvalues()`).
  - Removed "missing data" (use of `is.na()` within `filter()`).

```{r echo=FALSE}
#!# Load and Prep Data
```
```{r load1}
#!# Set to your own working directory and have just your filename below.
gss <- read.csv("https://raw.githubusercontent.com/droglenc/NCData/master/GSS_Enviro_2010.csv",
                na.strings=c("na","NA","-1","7","8","9","98","99")) %>%
  mutate(SEX=plyr::mapvalues(SEX,from=1:2,to=c("Male","Female")),
         RACE=plyr::mapvalues(RACE,from=1:3,to=c("White","Black","Other")),
         DEGREE=plyr::mapvalues(DEGREE,from=0:4,
           to=c("Less than HS","High School","Junior College","Bachelors","Graduate School")),
         GRNSOL = plyr::mapvalues(GRNSOL,from=0:5,
           to=c(NA_character_,"Very","Fairly","Neither","Not Very","Not At All")),
         GRNCON = plyr::mapvalues(GRNCON,from=0:5,
           to=c(NA_character_,"Not at All","Not Much","Neither","Somewhat","Very"))) %>%
  filter(!is.na(GRNSOL),!is.na(GRNCON))
```

---

# Background

- Loaded data into `gss` data.frame.
  - Converted all variables to factors and ordered all levels (use of `levels=` in `factor()` in `mutate()`).
  - Selected only three variables, for simplicity (use of `select()`).

```{r echo=FALSE}
#!# Controlling order of levels of factor variables (where order is important)
#!# Narrowing only to those variables of interest for the slides
```
```{r load2}
gss <- gss %>%
  mutate(SEX=factor(SEX),RACE=factor(RACE,levels=c("White","Black","Other")),
         DEGREE=factor(DEGREE,levels=c("Less than HS","High School","Junior College",
                                       "Bachelors","Graduate School")),
         GRNSOL = factor(GRNSOL,levels=c("Not At All","Not Very","Neither","Fairly","Very")),
         GRNCON = factor(GRNCON,levels=c("Not at All","Not Much","Neither","Somewhat","Very"))) %>%
  select(SEX,DEGREE,GRNSOL)
```

---

# Background

```{r}
head(gss)
```

- Variables used are:
  - **SEX**: Sex of respondent (`Female` or `Male`).
  - **DEGREE**: Respondent's highest completed degree.
  - **GRNSOL**: Response to "willingness to cut standard of living" question.

--
- Color palette used is:

```{r echo=FALSE}
#!# Declaring a color palette so I don't have to type this every time
```
```{r}
clrs <- c("#E69F00","#56B4E9","#009E73","#F0E442","#0072B2")
```

---

# Bar Chart

.pull-left[
- Displays the frequency of observations in levels of the categorical *X* variable.
- Constructed with `geom_bar()`.
  - `position=`: Controls position of bars with groups.
  - `width=`: Width of bars.
]

.pull-right[
```{r echo=FALSE}
#!# Derek ... delete this in the script
```
```{r bar_demo, echo=FALSE}
b <- ggplot(data=gss, mapping=aes(x=GRNSOL)) +
  geom_bar(color="gray30",fill="gray30",alpha=0.75) +
  scale_x_discrete(name="Willingness to Pay") +
  scale_y_continuous(name="Frequency of Respondents",
                     expand=expansion(mult=c(0,0.05))) +
  theme_bw() +
  theme(panel.grid.major.x=element_blank(),
        panel.grid.minor.x=element_blank())
b
```
]

---

class: inverse, center, middle

# Bar Chart with Typical Modifications

---

```{r echo=FALSE}
#!# Bar Chart with Typical Modifications
```
```{r bar1, include=FALSE}
b <- ggplot(data=gss, mapping=aes(x=GRNSOL)) +
  geom_bar(color="gray30",fill="gray30",alpha=0.75) +
  scale_x_discrete(name="Willingness to Pay") +
  scale_y_continuous(name="Frequency of Respondents",
                     expand=expansion(mult=c(0,0.05))) +
  theme_bw() +
  theme(panel.grid.major.x=element_blank(),
        panel.grid.minor.x=element_blank())
```

`r chunk_reveal("bar1",break_type="auto",left_assign=leftAssign,split=splitPerc)`


---

class: inverse, center, middle

# Stacked Bar Chart (by Groups)

### Make sure "groups" on x-axis and "response" on y-axis

---

```{r echo=FALSE}
#!# Stacked Bar Chart (by Groups)
```

```{r bar2, include=FALSE}
b <- ggplot(data=gss, mapping=aes(
  x=SEX,
  fill=GRNSOL #BREAK2
  )) +
  geom_bar(color="gray30",alpha=0.75) +
  scale_x_discrete(name="Sex of Respondent") +
  scale_y_continuous(name="Frequency of Respondents",
                     expand=expansion(mult=c(0,0.05))) +
  scale_fill_manual(name="Willingness?",values=clrs) + #BREAK3
  theme_bw() +
  theme(panel.grid.major.x=element_blank(),
        panel.grid.minor.x=element_blank())
```

`r chunk_reveal("bar2",break_type="non_seq",left_assign=leftAssign,split=splitPerc)`

---

```{r echo=FALSE}
#!# Stacked Bar Chart 2
```

```{r bar3, include=FALSE}
b <- ggplot(data=gss, mapping=aes(
  x=DEGREE,
  fill=GRNSOL #BREAK2
  )) +
  geom_bar(color="gray30",alpha=0.75) +
  scale_x_discrete(name="Highest Completed Degree") +
  scale_y_continuous(name="Frequency of Respondents",
                     expand=expansion(mult=c(0,0.05))) +
  scale_fill_manual(name="Willingness?",values=clrs) + #BREAK3
  theme_bw() +
  theme(panel.grid.major.x=element_blank(),
        panel.grid.minor.x=element_blank())
```

`r chunk_reveal("bar3",break_type="non_seq",left_assign=leftAssign,split=splitPerc)`

---

class: inverse, center, middle

# Side-by-Side Bar Chart (by Group)

---

```{r echo=FALSE}
#!# Side-by-Side Bar Chart
```

```{r bar3a, include=FALSE}
b <- ggplot(data=gss, mapping=aes(x=DEGREE,fill=GRNSOL)) +
  geom_bar(
    color="gray30",
    alpha=0.75,
    position="dodge" #BREAK2
  ) +
  scale_x_discrete(name="Highest Completed Degree") +
  scale_y_continuous(name="Frequency of Respondents",
                     expand=expansion(mult=c(0,0.05))) +
  scale_fill_manual(name="Willingness?",values=clrs) +
  theme_bw() +
  theme(panel.grid.major.x=element_blank(),
        panel.grid.minor.x=element_blank())
```

`r chunk_reveal("bar3a",break_type="non_seq",left_assign=leftAssign,split=splitPerc)`

---

class: inverse, center, middle

# Flipped Axes

### Can sometimes help with long level names (though we will also handle this later)

---

```{r echo=FALSE}
#!# Flipping the Axes on the Side-by-Side Bar Chart
```

```{r bar3b, include=FALSE}
b + #BREAK
  coord_flip()
```

`r chunk_reveal("bar3b",break_type="user",split=splitPerc)`


---

class: inverse, center, middle

# Bar Charts from Summaries

---

# Bar Charts from Summaries
- Data must be in "tidy format."
  - Each **row** represents one **individual** (i.e., observation or unit).
  - Each **column** represents one **variable**.

---

class: inverse, center, middle

# Summarizing Data
### Univariate Counts

---

```{r echo=FALSE}
#!# Bar Chart from Summarized Counts (only one variable)
```

```{r sum1, include=FALSE}
gss_sum1 <- gss %>%
  group_by(GRNSOL) %>%
  summarize(freq=n())
```

`r chunk_reveal("sum1",break_type="auto",left_assign=leftAssign,split=splitPerc)`

---

# Bar Charts from Summaries
- Constructed with `geom_bar()`, but using `stat="identity"`.
  - Forces to use actual values rather than "counting" as it does by default.

```{r bar1a, include=FALSE}
b <- ggplot(data=gss_sum1, mapping=aes(x=GRNSOL,y=freq)) + #BREAK
  geom_bar(stat="identity",color="gray30",fill="gray30",alpha=0.75) + #BREAK
  scale_x_discrete(name="Willingness to Pay") +
  scale_y_continuous(name="Frequency of Respondents",
                     expand=expansion(mult=c(0,0.05))) +
  theme_bw() +
  theme(panel.grid.major.x=element_blank(),
        panel.grid.minor.x=element_blank())
```

---

`r chunk_reveal("bar1a",break_type="user",left_assign=leftAssign,split=splitPerc)`

---

class: inverse, center, middle

# Summarizing Data
### Bivariate Counts

---

```{r echo=FALSE}
#!# Bar Chart from Summarized Counts (two variables)
```

```{r sum2, include=FALSE}
gss_sum2 <- gss %>%
  group_by(SEX,GRNSOL) %>%
  summarize(freq=n()) %>%
  ungroup()
```

`r chunk_reveal("sum2",break_type="auto",left_assign=leftAssign,split=splitPerc)`

---

```{r bar2a, include=FALSE}
b <- ggplot(data=gss_sum2,
            mapping=aes(x=SEX,y=freq,fill=GRNSOL)) + #BREAK
  geom_bar(stat="identity",color="gray30",alpha=0.75) + #BREAK
  scale_x_discrete(name="Sex of Respondent") +
  scale_y_continuous(name="Frequency of Respondents",
                     expand=expansion(mult=c(0,0.05))) +
  scale_fill_manual(name="Willingness?",values=clrs) +
  theme_bw() +
  theme(panel.grid.major.x=element_blank(),
        panel.grid.minor.x=element_blank())
```

`r chunk_reveal("bar2a",break_type="user",left_assign=leftAssign,split=splitPerc)`

---

# Advantage to Summaries?

- Sometimes this is the only data you have.

&nbsp;

--
- You can easily turn frequencies into percentages.

```{r echo=FALSE}
#!# Stacked Bar Chart of Percentages
```

```{r sum2b, include=FALSE}
gss_sum3 <- gss %>%
  group_by(SEX,GRNSOL) %>%
  summarize(freq=n()) %>% #BREAK
  mutate(perc=freq/sum(freq)*100) %>% #BREAK
  ungroup() #BREAK
```

---

`r chunk_reveal("sum2b",break_type="user",left_assign=leftAssign,split=splitPerc)`

---

class: inverse, center, middle

# Stacked Percentages Plots

---

```{r bar2b, include=FALSE}
b <- ggplot(data=gss_sum3,
            mapping=aes(x=SEX,y=perc,fill=GRNSOL)) + #BREAK
  geom_bar(stat="identity",color="gray30",alpha=0.75) + #BREAK
  scale_x_discrete(name="Sex of Respondent") +
  scale_y_continuous(name="Percentage of Respondents",
                     expand=expansion(mult=c(0,0.05))) +
  scale_fill_manual(name="Willingness?",values=clrs) +
  theme_bw() +
  theme(panel.grid.major.x=element_blank(),
        panel.grid.minor.x=element_blank())
```

`r chunk_reveal("bar2b",break_type="user",left_assign=leftAssign,split=splitPerc)`

---

```{r echo=FALSE}
#!# Stacked Bar Chart of Percentages 2
```

```{r sum2c, include=FALSE}
gss_sum3 <- gss %>%
  group_by(DEGREE,GRNSOL) %>%
  summarize(freq=n()) %>%
  mutate(perc=freq/sum(freq)*100) %>%
  ungroup()
```

`r chunk_reveal("sum2c",break_type=1,left_assign=leftAssign,split=splitPerc)`

---

```{r bar3c, include=FALSE}
b <- ggplot(data=gss_sum3,
            mapping=aes(x=DEGREE,y=perc,fill=GRNSOL)) +
  geom_bar(stat="identity",color="gray30",alpha=0.75) + #BREAK
  scale_x_discrete(name="Highest Degree Completed") +
  scale_y_continuous(name="Percentage of Respondents",
                     expand=expansion(mult=c(0,0.05))) +
  scale_fill_manual(name="Willingness?",values=clrs) +
  theme_bw() +
  theme(panel.grid.major.x=element_blank(),
        panel.grid.minor.x=element_blank()) + #BREAK
  coord_flip()
```

`r chunk_reveal("bar3c",break_type="user",left_assign=leftAssign,split=splitPerc)`

---

class: inverse, center, middle

# Next Time

<font size="7">We will examine graphs from summary statistics, including measures of uncertainty.</font>
