---
layout: page
title: Exercise - MLB Batting
author: Derek H. Ogle
css: "/css/modules.css"
output:
  html_document:
    self_contained: false
    lib_dir: zlibs
---

```{r echo=FALSE, eval=FALSE}
# Renders an appropriate HTML file for the webpage (CTRL-S and CTRL-ALT-C)
source(file.path(here::here(),"rhelpers/rhelpers.R"))
fnm <- "CE_MLBBatting"
dnm <- "modules/Univariate_Groups"
modHTML(file.path(here::here(),dnm,fnm))
FSA::purl2(file.path(here::here(),dnm,paste0(fnm,".Rmd")),
           moreItems=c("source","setwd","fnm","dnm","opts_chunk","CTRL-S"))
```
```{r echo=FALSE}
knitr::opts_chunk$set(echo=FALSE, fig.width=5, fig.height=5,out.width="60%")
```

----

## Background
<img src="../zimgs/qb.jpg" alt="Quarterback" class="img-right">

[sports-reference.com](https://www.sports-reference.com/) has a wealth of information on major American sports. In this exercise, statistics for Major League Baseball (MLB) players during the 2019 season will be explored. Before loading these data, load the `tidyverse` package, which will load `ggplot2` along with a few other packages you will need to access these data.

```{r echo=TRUE, results="hide"}
library(tidyverse)
```

Perform the following steps to load information [in this file](https://derekogle.com/NCGraphing/modules/zdata/MLB19_Batting.csv) for all players from the 2019 season that had at least 200 at-bats (in one league) and were in the top 100 with respect to batting "average."[^getdata]

```{r echo=TRUE, results='hide'}
mlb <- read.csv("https://derekogle.com/NCGraphing/modules/zdata/MLB19_Batting.csv",
                stringsAsFactors=FALSE) %>%
  select(Name,Age,Lg,G,AB,H,HR,RBI,BB,BA) %>%
  filter(Lg!="MLB",AB>200) %>%  # >200 at-bats in one league
  mutate(Lg=factor(Lg)) %>%
  top_n(n=100,wt=BA) %>%        # players in top 100 by batting average
  mutate(Age_grp=case_when(     # create age groups
    Age < 24 ~ "<24 yrs",
    Age < 30 ~ "24-30 yrs",
    TRUE ~ ">30 yrs"),
    Age_grp=factor(Age_grp,levels=c("<24 yrs","24-30 yrs",">30 yrs")))
str(mlb)
```

Here we will only use the following variables:

* `BA`: Batting average (as a proportion).
* `Lg`: League competed in (`AL` or `NL`.
* `Age_grp`: Age grouping (`<24 yrs`, `24-30 yrs`, `>30 yrs`).

&nbsp;

## Age Groups 1
Construct `ggplot2` code to match the graph below (as closely as you can).

```{r ages}
ages1 <- ggplot(data=mlb,mapping=aes(x=Age_grp)) +
  geom_bar(color="gray30",fill="wheat") +
  scale_x_discrete(name="Age Group") +
  scale_y_continuous(name="Frequency of Players",expand=expansion(mult=c(0,0.05))) +
  theme_bw() +  
  theme(panel.grid.major.x=element_blank(),panel.grid.minor.x=element_blank())
ages1
```

&nbsp;

## League and Age Group 1
Construct `ggplot2` code to match the graph below (as closely as you can ... *you don't have to match my colors, but do use other than the default colors*).

```{r MLB_LgAge1, fig.width=6.5, out.width="75%"}
lgage1 <- ggplot(data=mlb,mapping=aes(x=Lg,fill=Age_grp)) +
  geom_bar(color="gray30",alpha=0.7) +
  scale_x_discrete(name="League") +
  scale_y_continuous(name="Frequency of Players",expand=expansion(mult=c(0,0.05))) +
  scale_fill_manual(name="Age Group",values=c("#E69F00","#0072B2","#CC79A7")) +
  theme_bw() +  
  theme(panel.grid.major.x=element_blank(),panel.grid.minor.x=element_blank())
lgage1
```

&nbsp;

## League and Age Group 2
Construct `ggplot2` code to match the graph below (as closely as you can).

```{r MLB_LgAge2, fig.width=6.5, out.width="75%"}
lgage2 <- ggplot(data=mlb,mapping=aes(x=Lg,fill=Age_grp)) +
  geom_bar(position="dodge",color="gray30",alpha=0.7) +
  scale_x_discrete(name="League") +
  scale_y_continuous(name="Frequency of Players",expand=expansion(mult=c(0,0.05))) +
  scale_fill_manual(name="Age Group",values=c("#E69F00","#0072B2","#CC79A7")) +
  coord_flip() +
  theme_bw() +
  theme(panel.grid.major.x=element_blank(),panel.grid.minor.x=element_blank())
lgage2
```

&nbsp;

## Age Group 2
Recreate the plot in the "Region 1" section but using summarized data (*i.e., summarize the data first and then use that to construct the plot*).

```{r Loons_Reg2, fig.show='hide'}
sum1 <- mlb %>%
  group_by(Age_grp) %>%
  summarize(freq=n()) %>%
  ungroup()

age1a <- ggplot(data=sum1,mapping=aes(x=Age_grp,y=freq)) +
  geom_bar(stat="identity",color="gray30",fill="wheat") +
  scale_x_discrete(name="Age Group") +
  scale_y_continuous(name="Frequency of Players",expand=expansion(mult=c(0,0.05))) +
  theme_bw() +  
  theme(panel.grid.major.x=element_blank(),panel.grid.minor.x=element_blank())
age1a
```

&nbsp;

## League and Age Group 3
Recreate the plot in "League and Age Group 2" using summarized data. [*Hint: you will be asked to use percentages in the next section, so you should prepare your summaries here for that*.]

```{r MLB_LgAge3, fig.show='hide'}
sum2 <- mlb %>%
  group_by(Lg,Age_grp) %>%
  summarize(freq=n()) %>%
  mutate(perc=freq/sum(freq)*100) %>%
  ungroup()
  
lgage3 <- ggplot(data=sum2,mapping=aes(x=Lg,y=freq,fill=Age_grp)) +
  geom_bar(stat="identity",color="gray30",alpha=0.7) +
  scale_x_discrete(name="League") +
  scale_y_continuous(name="Frequency of Players",expand=expansion(mult=c(0,0.05))) +
  scale_fill_manual(name="Age Group",values=c("#E69F00","#0072B2","#CC79A7")) +
  coord_flip() +
  theme_bw() +  
  theme(panel.grid.major.x=element_blank(),panel.grid.minor.x=element_blank())
lgage3
```

&nbsp;

## League and Age Group 4
Construct `ggplot2` code to match the graph below (as closely as you can).

```{r MLB_LgAge4, fig.width=6.5, out.width="75%"}
lgage4 <- ggplot(data=sum2,mapping=aes(x=Lg,y=perc,fill=Age_grp)) +
  geom_bar(stat="identity",color="gray30",alpha=0.7) +
  scale_x_discrete(name="League") +
  scale_y_continuous(name="Percentage of Players",expand=expansion(mult=c(0,0.05))) +
  scale_fill_manual(name="Age Group",values=c("#E69F00","#0072B2","#CC79A7")) +
  coord_flip() +
  theme_bw() +  
  theme(panel.grid.major.x=element_blank(),panel.grid.minor.x=element_blank())
lgage4
```

[^getdata]: These data were obtained from https://www.sports-reference.com/ with the following steps: 1) Select "Baseball" in the list of sports in the gray box near the top of the page; 2) Select "Seasons" in the list of items in the gray box near the top of the page; 3) Select "Batting" after "All Major Leagues" under "League Index", 4) Select "2019" in the list of years; 5) Scroll down to "Player Standard Batting"; 6) hover over the "Share & more" item just after "Player Standard Batting" above the table of statistics and select "Get Table as a CSV"; and 7) copy CSV result to a text file.
