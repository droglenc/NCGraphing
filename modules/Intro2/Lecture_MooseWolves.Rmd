---
title: "Introduction to ggplot2"
author: "`r paste('Derek Ogle,',format(Sys.time(),'%B %Y'),sep=' ')`"
output:
  xaringan::moon_reader:
    lib_dir: zlibs
    css: ["zlibs/xaringan-themer.css", "hygge", "ninjutsu"]
    nature:
      ratio: 16:10
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r purler, eval=FALSE, echo=FALSE}
## Use Knit button to make actual slides.
## Makes (Ctrl-S & Ctrl-Alt-C) a script ... will need to edit.
fnm <- "Lecture_MooseWolves"
FSA::purl2(file.path(here::here(),"modules/Intro2",paste0(fnm,".Rmd")),
           moreItems=c("source","setwd","fnm","opts_chunk","flipbookr","cache",
                       "include_graphics","options","splitPerc","leftAssign"))
```


```{r setup, include = FALSE}
source("../zzzflipbook_settings.R")
#!# Loading the tidyverse package (must do every time)
library(tidyverse)
```

class: inverse, center, middle

# Today's Goal

<font size="7">Build upon the basics of ggplot2 that we developed last time by adding more controls over elements of the graph.</font>

---

# Background

- Estimated counts of Gray Wolf (*Canis lupus*) and Moose (*Alces alces*) from Isle Royale.

.center[
```{r, echo=FALSE, out.width="500px"}
knitr::include_graphics("https://derekogle.com/NCGraphing/modules/zimgs/wolves_moose.jpg")
```
<font size="1">Credit: <a href="https://www.mtu.edu/news/stories/2012/march/wolf-population-isle-royale-drops-lowest-has-ever-been.html">Michigan Technological University</a></font>
]

---

# Background

- Downloaded 'Data_wolves_moose_Isle_Royale_June2019.xlsx' Excel file from [Wolves & Moose of Isle Royale](https://isleroyalewolf.org/data/data/home.html), deleted first row of the first sheet, and saved the first sheet as [this CSV file](https://raw.githubusercontent.com/droglenc/NCData/master/WolvesMoose_IsleRoyale_June2019.csv).

&nbsp;

--
- Loaded the data into the `irmw` object.

```{r echo=FALSE}
#!# Load and Prep Data
```
```{r load1, eval=-1}
#!# Set to your own working directory and have just your filename below.
irmw <- read.csv("https://raw.githubusercontent.com/droglenc/NCData/master/WolvesMoose_IsleRoyale_June2019.csv",
                 na.strings=c("NA","N/A"))
```


---

# Background

- Selected only five variables.
- Renamed two variables with space in names (and long).
- Changed categorical data from numbers to words and converted to a factor.

```{r echo=FALSE}
#!# Cleaning up messy names and reducing size of data.frame (for lecture only)
```
```{r load2}
irmw %<>%
  select(year,wolves,moose,Jan.Feb..temp..F.,ice.bridges..0.none..1...present.) %>%
  rename(winter_temp=Jan.Feb..temp..F.,
         ice_bridges=ice.bridges..0.none..1...present.) %>%
  mutate(ice_bridges=plyr::mapvalues(ice_bridges,from=c(0,1),to=c("no","yes")),
         ice_bridges=factor(ice_bridges))
```

---

# Background

```{r}
head(irmw)
```

- Variables are:
  - **year**: Calendar year of observation.
  - **wolves**: Estimated number of wolves present that year.
  - **moose**: Estimated number of moose present that year.
  - **winter_temp**: Mean January-February temperature (<sup>o</sup>F).
  - **ice_bridges**: Whether or not an ice bridge formed to the mainland.

---

### What is Happening Here? Where is the graph?

```{r echo=FALSE}
#!# Making a simple line plot of number of wolves by year
```
```{r line_yr, echo=TRUE}
p <- ggplot(data=irmw,mapping=aes(x=year,y=wolves)) +
  geom_line()
```

--
```{r fig.width=2.5, fig.height=2.5, out.width="45%"}
p
```

---

class: inverse, center, middle

### Controlling Specific Aspects of the Graph

---

# Aesthetics

- Visual properties of geoms on the graph.

--
- Commonly used aesthetics are:
  - `x=`: positioning along x-axis.
  - `y=`: positioning along y-axis.

--
  - `color=`: [color](https://derekogle.com/NCGraphing/resources/colors) of objects or, if 2-d (e.g., bars, some points), object's outline.

--
  - `fill=`: fill [color](https://derekogle.com/NCGraphing/resources/colors) of objects.

--
  - `alpha=`: color transparency color (0 [fully transparent] to 1 [fully opaque]).

--
  - `shape=`: [shape](https://ggplot2.tidyverse.org/articles/ggplot2-specs.html#point) of markers in scatter plots.

--
  - `size=`: how large objects appear.

--
  - `linetype=`: how [lines](https://ggplot2.tidyverse.org/articles/ggplot2-specs.html#lines) should be drawn (`"solid"`, `"dashed"`, `"dotted"`, etc.)

&nbsp;

--
- Which aesthetics are required and allowed vary by geom.

---

class: inverse, center, middle

# Aesthetics
### Can be *set* for all data within each 'geom'.

```{r echo=FALSE}
#!# Setting aesthetics within a geom
```
```{r scatline_yr2a, eval=-1, include=FALSE}
p <- ggplot(data=irmw,
            mapping=aes(x=year,y=wolves)) +
  geom_point(
    color="red", #BREAK2
    size=1 #BREAK3
  ) +
  geom_line(
    size=0.25, #BREAK4
    linetype="dashed" #BREAK5
  )
```


```{r echo=FALSE}
#!# ... order of geoms matters
```
```{r scatline_yr2b, include=FALSE}
p <- ggplot(data=irmw,
            mapping=aes(x=year,y=wolves)) +
  geom_line(size=0.25,linetype="dashed") +
  geom_point(color="red",size=1)
```
---

`r chunk_reveal("scatline_yr2a",break_type="non_seq",left_assign=leftAssign,split=splitPerc)`

---

class: inverse, center, middle

### Order of geoms Becomes Apparent

---

`r chunk_reveal("scatline_yr2b",break_type="auto",left_assign=leftAssign,split=splitPerc)`

---

class: inverse, center, middle

# Aesthetics
### Can be *globally mapped* to *a color* in aes() in mapping= in ggplot().

```{r echo=FALSE}
#!# Setting a color aesthetic for all geoms
```
```{r scatline_yr3a, include=FALSE}
p <- ggplot(data=irmw,
            mapping=aes(x=year,y=wolves,
                        color="red" #BREAK2
                        )) +
  geom_line() +
  geom_point(size=1)
```

---

`r chunk_reveal("scatline_yr3a",break_type="non_seq",left_assign=leftAssign,split=splitPerc)`

---

class: inverse, center, middle

# Aesthetics
### Can be *globally mapped* to *a variable* in aes() in mapping= in ggplot().

```{r echo=FALSE}
#!# Mapping a color aesthetic to a variable for all geoms
```
```{r scatline_yr3b, include=FALSE}
p <- ggplot(data=irmw,
            mapping=aes(x=year,y=wolves,
                        color=ice_bridges #BREAK2
                        )) +
  geom_line() +
  geom_point(size=1)
```

---

`r chunk_reveal("scatline_yr3b",break_type="non_seq",left_assign=leftAssign,split=splitPerc)`

---

class: inverse, center, middle

# Aesthetics
### Can be *mapped* to *a variable* for a specific 'geom' with aes() in the geom_XXXX().

```{r echo=FALSE}
#!# Mapping a color aesthetic to a variable for one geom
```
```{r scatline_yr3c, include=FALSE}
p <- ggplot(data=irmw,
            mapping=aes(x=year,y=wolves)) +
  geom_line() +
  geom_point(
    aes(color=ice_bridges), #BREAK2
    size=1
  )
```

```{r scatline_yr3d, include=FALSE}
p <- ggplot(data=irmw,
            mapping=aes(x=year,y=wolves)) +
  geom_line() +
  geom_point(
    aes(color=winter_temp), #BREAK2
    size=1
  )
```

```{r scatline_yr3e, include=FALSE}
p <- ggplot(data=irmw,
            mapping=aes(x=year,y=wolves)) +
  geom_line() +
  geom_point(
    aes(
      color=winter_temp, #BREAK2
      shape=ice_bridges #BREAK3
      ),
      size=1)
```

---

`r chunk_reveal("scatline_yr3c",break_type="non_seq",left_assign=leftAssign,split=splitPerc)`

---

`r chunk_reveal("scatline_yr3d",break_type="non_seq",left_assign=leftAssign,split=splitPerc)`

---

`r chunk_reveal("scatline_yr3e",break_type="non_seq",left_assign=leftAssign,split=splitPerc)`

---

# Scales

- Scales define how values of the aesthetic are mapped to values of the data

--
- For example ...
  - Defines colors used for each group.
  - Defines shapes of points used for each group.
  - Defines characteristics of axes (e.g., labels, breaks, limits).

--
- All scales have sensible defaults; but you may want to change.

&nbsp;

--
- Scale functions are of the form `scale_`*`aesthetic`*`_`*`suffix`*.
  - *`aesthetic`* is an aesthetic name (e.g., `color`, `shape`, `x`).
  - *`suffix`* is the functionality of the scale (e.g., `manual`, `discrete`).

&nbsp;

--
- Basic functionality introduced here, more details in subsequent modules.

```{r echo=FALSE}
#!# Using scales to control colors and axis labels
```
```{r scatline_yr4a, include=FALSE}
p <- ggplot(data=irmw,
            mapping=aes(x=year,y=wolves)) +
  geom_line() +
  geom_point(aes(color=ice_bridges),size=1) + #BREAK
  scale_color_manual(values=c("blue","red"),
                     name="Ice Bridge?") + #BREAK
  scale_x_continuous(name="Year",
                     breaks=seq(1960,2020,10),
                     minor_breaks=seq(1959,2019,1)) + #BREAK
  scale_y_continuous(name="Estimated Number of Wolves",
                     breaks=seq(0,50,5),
                     minor_breaks=NULL)
```


---

class: inverse, center, middle

# Using Scales to Change ...
### Default Colors
### Axis Names and Breaks

---

`r chunk_reveal("scatline_yr4a",break_type="user",left_assign=leftAssign,split=splitPerc)`

---

# Themes

- A theme controls elements of the graph not related to data; e.g.,
  - Background color.
  - Size of font.
  - Gridlines.

--
- Each of these elements can be individually modified.

--
- Entire themes can be created and saved for continual use.

--
- We will revisit details of themes in a later module.

--
- However, common themes exist; e.g.,
  - `theme_bw()`
  - `theme_gray()`
  - `theme_minimal()`
  - `theme_classic()`

```{r echo=FALSE}
#!# Demonstrating themes
```
```{r scatline_yr5, include=FALSE}
p <- ggplot(data=irmw,
            mapping=aes(x=year,y=wolves)) +
  geom_line() +
  geom_point(aes(color=ice_bridges),size=1) +
  scale_color_manual(values=c("blue","red"),
                     name="Ice Bridge?") +
  scale_x_continuous(name="Year",
                     breaks=seq(1960,2020,5)) +
  scale_y_continuous(name="Estimated Number of Wolves",
                     breaks=seq(0,50,5))
```

```{r scatline_yr5a, include=FALSE}
p + #BREAK
  theme_classic()
```

```{r scatline_yr5b, include=FALSE}
 p + #BREAK
  theme_minimal()
```

```{r scatline_yr5c, include=FALSE}
p + #BREAK
  theme_bw()
```

---

`r chunk_reveal("scatline_yr5",break_type=1,left_assign=leftAssign,split=splitPerc)`

---

`r chunk_reveal("scatline_yr5a",break_type="user",split=splitPerc)`

---

`r chunk_reveal("scatline_yr5b",break_type="user",split=splitPerc)`

---

`r chunk_reveal("scatline_yr5c",break_type="user",split=splitPerc)`

---

## Final Thought for Next Time

> "[This book will] introduce you to `ggplot2` as a novice, unfamiliar with the grammar; teach you the basics so that you can re-create plots you are already familiar with [and] show you how to use the grammar to create new types of graphics ..." -- Wickham (2009)

.pull-right[
![Hadley Wickham](https://derekogle.com/NCGraphing/modules/zimgs/wickham.jpg)
]
---

class: inverse, center, middle

# Next Time

<font size="7">We will examine graphs for distributions of quantitative data.</font>
